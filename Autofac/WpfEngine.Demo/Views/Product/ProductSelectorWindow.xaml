<local:ScopedWindow xmlns:local="clr-namespace:WpfEngine.Demo.Views"
                    x:Class="WpfEngine.Demo.Views.ProductSelectorWindow"
                    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    Title="ðŸ›ï¸ Product Selector (In Workflow Session)"
                    Width="900" Height="700"
                    WindowStartupLocation="CenterScreen"
                    Background="#F8F9FA">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" 
                Background="#8B5CF6" 
                CornerRadius="12" 
                Padding="24"
                Margin="0,0,0,16">
            <StackPanel>
                <TextBlock Text="ðŸ›ï¸ Product Selector" 
                           FontSize="28" 
                           FontWeight="Bold" 
                           Foreground="White"/>
                <TextBlock Text="Select products to add to order - shares state with workflow!" 
                           FontSize="14" 
                           Foreground="#EDE9FE"
                           Margin="0,4,0,0"/>
            </StackPanel>
        </Border>

        <!-- Current Order Summary (SHARED STATE!) -->
        <Border Grid.Row="1"
                Background="#DBEAFE"
                BorderBrush="#3B82F6"
                BorderThickness="2"
                CornerRadius="8"
                Padding="16"
                Margin="0,0,0,16">
            <StackPanel>
                <TextBlock Text="ðŸ“‹ Shared Order State" 
                           FontSize="14" 
                           FontWeight="Bold"
                           Foreground="#1E40AF"
                           Margin="0,0,0,8"/>
                <TextBlock Text="{Binding CurrentOrderSummary}" 
                           FontSize="13"
                           Foreground="#1E40AF"/>
                <TextBlock Text="â­ This data is synchronized across ALL workflow windows!" 
                           FontSize="11"
                           Foreground="#60A5FA"
                           FontStyle="Italic"
                           Margin="0,4,0,0"/>
            </StackPanel>
        </Border>

        <!-- Product List -->
        <Border Grid.Row="2"
                Background="White"
                CornerRadius="8"
                Padding="0"
                Margin="0,0,0,16">
            <DataGrid ItemsSource="{Binding Products}"
                      SelectedItem="{Binding SelectedProduct}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      HeadersVisibility="Column"
                      GridLinesVisibility="None"
                      Background="White"
                      RowBackground="White"
                      AlternatingRowBackground="#F8FAFC"
                      BorderThickness="0">

                <DataGrid.Resources>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#F1F5F9"/>
                        <Setter Property="Foreground" Value="#1E293B"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Padding" Value="16,12"/>
                    </Style>
                </DataGrid.Resources>

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                    <DataGridTextColumn Header="Price" Binding="{Binding Price, StringFormat=C}" Width="100"/>
                    <DataGridTextColumn Header="Stock" Binding="{Binding Stock}" Width="80"/>
                    <DataGridTextColumn Header="Category" Binding="{Binding Category.Name}" Width="120"/>
                    
                    <DataGridTemplateColumn Header="Actions" Width="220">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="ðŸ‘ï¸ Detail"
                                            Command="{Binding DataContext.ViewDetailsCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Padding="10,6"
                                            Margin="0,0,8,0"
                                            Background="#8B5CF6"
                                            Foreground="White"
                                            BorderThickness="0"
                                            FontWeight="SemiBold"
                                            Cursor="Hand"/>
                                    
                                    <Button Content="âž• Add"
                                            Command="{Binding DataContext.AddToOrderCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Padding="10,6"
                                            Background="#10B981"
                                            Foreground="White"
                                            BorderThickness="0"
                                            FontWeight="SemiBold"
                                            Cursor="Hand"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Quantity Input -->
        <Border Grid.Row="3"
                Background="White"
                CornerRadius="8"
                Padding="16"
                Margin="0,0,0,16">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Default Quantity:" 
                           VerticalAlignment="Center"
                           Margin="0,0,12,0"
                           FontWeight="SemiBold"/>
                <TextBox Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged}"
                         Width="80"
                         Padding="8"
                         VerticalContentAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Actions -->
        <StackPanel Grid.Row="4" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right">
            <Button Content="Close" 
                    Command="{Binding CloseWindowCommand}"
                    Padding="20,12"
                    Background="White"
                    BorderBrush="#CBD5E1"
                    BorderThickness="1"
                    Foreground="#64748B"
                    FontWeight="SemiBold"
                    Cursor="Hand"/>
        </StackPanel>
    </Grid>
</local:ScopedWindow>

