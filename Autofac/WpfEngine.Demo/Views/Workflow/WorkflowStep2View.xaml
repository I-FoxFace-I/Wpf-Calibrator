<controls:BaseControlView  xmlns:controls="clr-namespace:WpfEngine.Views.Controls;assembly=WpfEngine" 
    x:Class="WpfEngine.Demo.Views.WorkflowStep2View"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,6">
                <TextBlock Text="📦 Add Products" 
                           FontSize="24" 
                           FontWeight="Bold" 
                           Foreground="#1E293B"
                           Margin="0,0,0,8"/>
                <TextBlock Text="{Binding CustomerName, StringFormat='Customer: {0}'}" 
                           FontSize="14" 
                           Foreground="#64748B"/>
            </StackPanel>

            <!-- Available Products -->
            <StackPanel Grid.Row="1" Margin="0,0,0,6">
                <Grid Margin="0,0,0,6">
                    <TextBlock Text="Available Products" 
                               FontSize="16" 
                               FontWeight="SemiBold"
                               VerticalAlignment="Center"/>
                    
                    <Button Content="🛍️ Open Product Selector Window"
                            Command="{Binding OpenProductSelectorCommand}"
                            Padding="12,8"
                            HorizontalAlignment="Right"
                            Background="#8B5CF6"
                            Foreground="White"
                            BorderThickness="0"
                            FontWeight="SemiBold"
                            Cursor="Hand"/>
                </Grid>

                <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="400">
                    <ItemsControl ItemsSource="{Binding Products}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="White" 
                                        BorderBrush="#E2E8F0" 
                                        BorderThickness="1"
                                        CornerRadius="8" 
                                        Padding="16" 
                                        Margin="0,0,0,6">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Product Info -->
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}" 
                                                       FontSize="16" 
                                                       FontWeight="SemiBold"
                                                       Foreground="#1E293B"
                                                       Margin="0,0,0,4"/>

                                            <TextBlock FontSize="13" 
                                                       Foreground="#64748B"
                                                       Margin="0,0,0,4">
                                                <Run Text="Price:"/>
                                                <Run Text="{Binding Price, StringFormat=C}" FontWeight="SemiBold" Foreground="#10B981"/>
                                                <Run Text=" | Stock:"/>
                                                <Run Text="{Binding Stock}" FontWeight="SemiBold"/>
                                            </TextBlock>

                                            <TextBlock Text="{Binding Description}" 
                                                       FontSize="12" 
                                                       Foreground="#94A3B8"
                                                       TextWrapping="Wrap"
                                                       MaxWidth="400"
                                                       HorizontalAlignment="Left"/>
                                        </StackPanel>

                                        <!-- Action Buttons -->
                                        <StackPanel Grid.Column="1" 
                                                    Orientation="Horizontal"
                                                    VerticalAlignment="Center">

                                            <!-- Quantity Input -->
                                            <Border Background="#F8FAFC" 
                                                    CornerRadius="6" 
                                                    Padding="8,4"
                                                    Margin="0,0,8,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="Qty:" 
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"
                                                               FontSize="13"
                                                               Foreground="#64748B"/>
                                                    <TextBox Width="50" 
                                                             Text="{Binding DataContext.Quantity, RelativeSource={RelativeSource AncestorType=ItemsControl}, UpdateSourceTrigger=PropertyChanged}"
                                                             Padding="4"
                                                             FontSize="14"
                                                             VerticalContentAlignment="Center"/>
                                                </StackPanel>
                                            </Border>

                                            <!-- View Info Button -->
                                            <Button Content="ℹ️ Info"
                                                    Command="{Binding DataContext.ViewProductInfoCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                    CommandParameter="{Binding}"
                                                    Padding="12,8"
                                                    Margin="0,0,8,0"
                                                    Background="#8B5CF6"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    FontWeight="SemiBold"
                                                    FontSize="13"
                                                    Cursor="Hand"
                                                    ToolTip="View product details"/>

                                            <!-- Add to Order Button -->
                                            <Button Content="➕ Add"
                                                    Command="{Binding DataContext.AddItemWithProductCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                    CommandParameter="{Binding}"
                                                    Padding="12,8"
                                                    Background="#10B981"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    FontWeight="SemiBold"
                                                    FontSize="13"
                                                    Cursor="Hand"
                                                    ToolTip="Add to order"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </StackPanel>

            <!-- Current Order Items -->
            <TextBlock Grid.Row="2" 
                       Text="Current Order" 
                       FontSize="16" 
                       FontWeight="SemiBold" 
                       Margin="0,0,0,6"/>

            <Border Grid.Row="3" 
                    Background="White" 
                    BorderBrush="#E2E8F0" 
                    BorderThickness="1"
                    CornerRadius="8"
                    Margin="0,0,0,6"
                    MinHeight="200">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding OrderItems}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#F8FAFC" 
                                        CornerRadius="6" 
                                        Padding="16" 
                                        Margin="8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" 
                                                   Text="{Binding ProductName}" 
                                                   FontWeight="SemiBold"
                                                   VerticalAlignment="Center"/>

                                        <TextBlock Grid.Column="1" 
                                                   Margin="12,0"
                                                   VerticalAlignment="Center">
                                            <Run Text="{Binding Quantity, Mode=OneWay}"/>
                                            <Run Text="x"/>
                                            <Run Text="{Binding Price, StringFormat=C, Mode=OneWay}"/>
                                        </TextBlock>

                                        <TextBlock Grid.Column="2" 
                                                   Text="{Binding Total, StringFormat=C}" 
                                                   FontWeight="Bold"
                                                   Foreground="#10B981"
                                                   Margin="12,0"
                                                   VerticalAlignment="Center"/>

                                        <Button Grid.Column="3" 
                                                Content="🗑️"
                                                Command="{Binding DataContext.RemoveItemCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                CommandParameter="{Binding}"
                                                Padding="8"
                                                Background="#EF4444"
                                                Foreground="White"
                                                BorderThickness="0"
                                                Cursor="Hand"
                                                ToolTip="Remove item"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <!-- Order Total -->
            <Border Grid.Row="4" 
                    Background="#F1F5F9" 
                    CornerRadius="8" 
                    Padding="20"
                    Margin="0,0,0,6">
                <Grid>
                    <TextBlock Text="Order Total:" 
                               FontSize="18" 
                               FontWeight="Bold"
                               VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding OrderTotal, StringFormat=C}" 
                               FontSize="18" 
                               FontWeight="Bold" 
                               Foreground="#10B981"
                               HorizontalAlignment="Right"
                               VerticalAlignment="Center"/>
                </Grid>
            </Border>

            <!-- Navigation Buttons -->
            <StackPanel Grid.Row="5" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Right"
                        Margin="0,0,0,32">
                <Button Content="← Back" 
                        Command="{Binding BackCommand}"
                        Padding="20,12"
                        Margin="0,0,12,0"
                        Background="White"
                        BorderBrush="#CBD5E1"
                        BorderThickness="1"
                        FontWeight="SemiBold"
                        Cursor="Hand"/>

                <Button Content="Next →" 
                        Command="{Binding NextCommand}"
                        Padding="20,12"
                        Background="#10B981"
                        Foreground="White"
                        BorderThickness="0"
                        FontWeight="SemiBold"
                        Cursor="Hand"/>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</controls:BaseControlView>